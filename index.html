<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <title>任务</title>
    <style>
      :root {
        color-scheme: light;
      }

      body {
        margin: 0;
        background: #ffffff;
        color: #111827;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "PingFang SC",
          "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
      }

      .page {
        min-height: 100dvh;
        padding-top: calc(env(safe-area-inset-top, 0px) + 24px);
        padding-right: 16px;
        padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 24px);
        padding-left: 16px;
        box-sizing: border-box;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .layout {
        width: 100%;
        max-width: 420px;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .top {
        padding-top: 8px;
      }

      .number {
        font-size: clamp(56px, 12vw, 76px);
        font-weight: 800;
        line-height: 1;
        text-align: center;
      }

      .number.is-red {
        color: #ef4444;
      }

      button {
        appearance: none;
        border: 0;
        border-radius: 14px;
        padding: 14px 16px;
        font-size: 18px;
        font-weight: 700;
        cursor: pointer;
        background: #16a34a;
        color: #ffffff;
        width: 100%;
        box-shadow: 0 10px 20px rgba(22, 163, 74, 0.22);
      }

      button:active {
        transform: translateY(1px);
      }

      button:focus-visible {
        outline: 3px solid rgba(22, 163, 74, 0.45);
        outline-offset: 3px;
      }

      .done {
        font-size: 28px;
        font-weight: 800;
        letter-spacing: 2px;
        text-align: center;
        color: #ffffff;
        background: #16a34a;
        border-radius: 16px;
        padding: 18px 16px;
        box-shadow: 0 10px 20px rgba(22, 163, 74, 0.18);
      }
    </style>
  </head>
  <body>
    <main class="page" aria-live="polite">
      <div class="layout">
        <div class="top">
          <div id="count" class="number is-red">200</div>
          <div id="done" class="done" hidden>任务完成</div>
        </div>
        <button id="decreaseBtn" type="button">减少</button>
      </div>
    </main>

    <script>
      const countEl = document.getElementById("count");
      const decreaseBtn = document.getElementById("decreaseBtn");
      const doneEl = document.getElementById("done");

      const STORAGE_KEY = "task_count";

      function getInitialCount() {
        const raw = localStorage.getItem(STORAGE_KEY);
        const parsed = raw === null ? NaN : Number.parseInt(raw, 10);

        if (Number.isFinite(parsed) && parsed >= 0) {
          return parsed;
        }

        return 200;
      }

      function persistCount(nextCount) {
        localStorage.setItem(STORAGE_KEY, String(nextCount));
      }

      let count = getInitialCount();

      function render() {
        countEl.textContent = String(count);

        const isDone = count <= 0;
        countEl.hidden = isDone;
        doneEl.hidden = !isDone;
        decreaseBtn.hidden = isDone;
      }

      function handleDecrease() {
        count = Math.max(0, count - 1);
        persistCount(count);
        render();
      }

      decreaseBtn.addEventListener("click", handleDecrease);
      persistCount(count);
      render();
    </script>
  </body>
</html>
